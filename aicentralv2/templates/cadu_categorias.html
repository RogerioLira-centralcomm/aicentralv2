{% extends 'base_tailwind.html' %}

{% block title %}Cadu Categorias - CentralComm AI{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6 space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-base-content">Cadu Categorias</h1>
      <p class="text-sm text-base-content/70 mt-1">Gerencie as categorias do catálogo de audiências</p>
    </div>
    <a href="{{ url_for('cadu_categorias_novo') }}" class="btn btn-primary">
      <i class="fas fa-plus mr-2"></i>Nova Categoria
    </a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="space-y-2">
        {% for category, message in messages %}
          <div class="alert {% if category == 'error' %}alert-error{% elif category == 'success' %}alert-success{% elif category == 'warning' %}alert-warning{% else %}alert-info{% endif %}">
            <i class="fas fa-{% if category == 'error' %}exclamation-circle{% elif category == 'success' %}check-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
            <span>{{ message }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Stats -->
  {% if categorias %}
  <div class="stats shadow w-full">
    <div class="stat">
      <div class="stat-figure text-primary">
        <i class="fas fa-folder text-4xl"></i>
      </div>
      <div class="stat-title">Total de Categorias</div>
      <div class="stat-value text-primary">{{ categorias|length }}</div>
    </div>
    
    <div class="stat">
      <div class="stat-figure text-success">
        <i class="fas fa-check-circle text-4xl"></i>
      </div>
      <div class="stat-title">Ativas</div>
      <div class="stat-value text-success">{{ categorias|selectattr('is_active')|list|length }}</div>
    </div>
    
    <div class="stat">
      <div class="stat-figure text-warning">
        <i class="fas fa-star text-4xl"></i>
      </div>
      <div class="stat-title">Destacadas</div>
      <div class="stat-value text-warning">{{ categorias|selectattr('is_featured')|list|length }}</div>
    </div>
    
    <div class="stat">
      <div class="stat-figure text-info">
        <i class="fas fa-users text-4xl"></i>
      </div>
      <div class="stat-title">Total Audiências</div>
      <div class="stat-value text-info">{{ categorias|sum(attribute='total_audiencias') or 0 }}</div>
    </div>
  </div>
  {% endif %}

  <!-- Grid de Cards -->
  {% if categorias %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for cat in categorias %}
    <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow {% if not cat.is_active %}opacity-60{% endif %}">
      <div class="card-body">
        <!-- Header do Card -->
        <div class="flex items-start justify-between">
          <div class="flex items-center gap-3">
            {% if cat.icone %}
            <div class="avatar placeholder">
              <div class="bg-primary text-primary-content rounded-lg w-12 h-12 flex items-center justify-center">
                <i class="{{ cat.icone }} text-2xl"></i>
              </div>
            </div>
            {% else %}
            <div class="avatar placeholder">
              <div class="bg-neutral text-neutral-content rounded-lg w-12 h-12">
                <span class="text-xl">{{ cat.nome[0:2]|upper if cat.nome else 'CA' }}</span>
              </div>
            </div>
            {% endif %}
            
            <div>
              <h3 class="card-title text-base">
                {{ cat.nome }}
                {% if cat.is_featured %}
                <i class="fas fa-star text-warning text-sm ml-1" title="Categoria em destaque"></i>
                {% endif %}
              </h3>
              {% if cat.slug %}
              <p class="text-xs text-base-content/50 font-mono">{{ cat.slug }}</p>
              {% endif %}
            </div>
          </div>
          
          {% if cat.cor_hex %}
          <div class="w-6 h-6 rounded-full border-2 border-base-300" style="background-color: {{ cat.cor_hex }};" title="Cor: {{ cat.cor_hex }}"></div>
          {% endif %}
        </div>

        <!-- Descrição -->
        {% if cat.descricao %}
        <p class="text-sm text-base-content/70 line-clamp-2 mt-2">{{ cat.descricao }}</p>
        {% endif %}

        <!-- Stats do Card -->
        <div class="flex items-center gap-4 mt-4">
          <div class="flex items-center gap-2">
            <i class="fas fa-users text-info text-xs"></i>
            <span class="text-xs font-medium">{{ cat.total_audiencias or 0 }} audiências</span>
          </div>
          <div class="flex items-center gap-2">
            <i class="fas fa-sort-amount-down text-neutral text-xs"></i>
            <span class="text-xs font-medium">Ordem: {{ cat.ordem_exibicao or 0 }}</span>
          </div>
        </div>

        <!-- Badges de Status -->
        <div class="flex flex-wrap gap-2 mt-3">
          <span class="badge badge-sm {% if cat.is_active %}badge-success{% else %}badge-error{% endif %}">
            <i class="fas fa-{% if cat.is_active %}check{% else %}times{% endif %} mr-1"></i>
            {{ 'Ativa' if cat.is_active else 'Inativa' }}
          </span>
          {% if cat.is_featured %}
          <span class="badge badge-sm badge-warning">
            <i class="fas fa-star mr-1"></i>Destaque
          </span>
          {% endif %}
        </div>

        <!-- Ações -->
        <div class="card-actions justify-end mt-4 pt-4 border-t border-base-300">
          <a href="{{ url_for('cadu_categorias_detalhes', id_categoria=cat.id) }}" 
             class="btn btn-xs btn-ghost"
             title="Ver detalhes">
            <i class="fas fa-eye"></i>
          </a>
          <a href="{{ url_for('cadu_categorias_editar', id_categoria=cat.id) }}" 
             class="btn btn-xs btn-primary"
             title="Editar">
            <i class="fas fa-edit"></i>
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <!-- Empty State -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body py-20">
      <div class="flex flex-col items-center justify-center text-center">
        <i class="fas fa-folder-open text-6xl text-base-content/20 mb-4"></i>
        <h3 class="font-semibold text-lg text-base-content/70 mb-2">Nenhuma categoria cadastrada</h3>
        <p class="text-sm text-base-content/50 mb-6">Comece criando sua primeira categoria de audiência</p>
        <a href="{{ url_for('cadu_categorias_novo') }}" class="btn btn-primary">
          <i class="fas fa-plus mr-2"></i>Criar Primeira Categoria
        </a>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
