{% extends 'base_tailwind.html' %}

{% block title %}Detalhes do Cliente - CentralComm AI{% endblock %}

{% block content %}
<h1>Detalhes do Cliente</h1>

<p>
  <a href="{{ url_for('cliente_editar', cliente_id=cliente.id_cliente) }}">Editar Cliente</a> |
  <a href="{{ url_for('clientes') }}">Voltar</a>
  </p>

<h2>Informações Principais</h2>
<ul>
  <li>ID do Cliente: #{{ cliente.id_cliente }}</li>
  <li>Status: {{ 'Ativo' if cliente.status else 'Inativo' }}</li>
  {% if cliente.pessoa != 'F' %}
  <li>Razão Social: {{ cliente.razao_social }}</li>
  {% endif %}
  <li>{{ 'Nome Completo' if cliente.pessoa == 'F' else 'Nome Fantasia' }}: {{ cliente.nome_fantasia }}</li>
  <li>{{ 'CPF' if cliente.pessoa == 'F' else 'CNPJ' }}: {{ cliente.cnpj or 'Não informado' }}</li>
  <li>Total de Contatos: {{ cliente.total_contatos }}</li>
  <li>Executivo de Vendas: {% if cliente.vendedor_nome %}{{ cliente.vendedor_nome }}{% if cliente.vendedor_cargo %} ({{ cliente.vendedor_cargo }}){% endif %}{% else %}—{% endif %}</li>
  <li>Apresentação do Executivo: {{ cliente.apresentacao_executivo_display or 'Não informado' }}</li>
  <li>Fluxo de Boas-Vindas: {{ cliente.fluxo_boas_vindas_display or 'Não informado' }}</li>
  {% if cliente.pessoa != 'F' %}
  <li>
    Agência:
    {% set ag_key = cliente.agencia_key|string|lower %}
    {{ 'Sim' if (cliente.agencia_key == True or ag_key in ['sim','true','1','s','yes','y']) else 'Não' }}
  </li>
  {% endif %}
  {% set ag_key = cliente.agencia_key|string|lower %}
  {% if cliente.pessoa != 'F' and (cliente.agencia_key == True or ag_key in ['sim','true','1','s','yes','y']) %}
  <li>Percentual: {{ cliente.percentual_display or '—' }}</li>
  {% endif %}
  <li>
    Estado:
    {% if cliente.estado_sigla or cliente.estado_descricao %}
      {{ cliente.estado_sigla }}{% if cliente.estado_sigla and cliente.estado_descricao %} - {% endif %}{{ cliente.estado_descricao }}
    {% else %}
      Não informado
    {% endif %}
  </li>
  <li>Tipo de Cliente: {{ cliente.tipo_cliente_display or 'Não informado' }}</li>
  {% if cliente.pessoa != 'F' %}
  <li>Inscrição Estadual: {{ cliente.inscricao_estadual or 'Não informado' }}</li>
  <li>Inscrição Municipal: {{ cliente.inscricao_municipal or 'Não informado' }}</li>
  {% endif %}
  <li>
    Plano:
    {% if cliente.plano_descricao %}
      {{ cliente.plano_descricao }} ({{ cliente.plano_tokens }} tokens)
    {% else %}
      Nenhum plano associado
    {% endif %}
  </li>
</ul>

{% if cliente.nome_fantasia.upper() != 'CENTRALCOMM' %}
<form method="POST" action="{{ url_for('cliente_toggle_status', cliente_id=cliente.id_cliente) }}">
  <button type="submit">{{ 'Desativar' if cliente.status else 'Ativar' }} Cliente</button>
</form>
{% endif %}

<h2>Contatos Vinculados</h2>
{% if contatos %}
<table>
  <thead>
    <tr>
      <th>Nome</th>
      <th>Email</th>
      <th>Telefone</th>
      <th>Setor</th>
      <th>Cargo</th>
      <th>Status</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
  {% for contato in contatos %}
    <tr>
      <td>{{ contato.nome_completo }}</td>
      <td>{{ contato.email }}</td>
      <td>{{ contato.telefone or 'Não informado' }}</td>
      <td>{{ contato.setor_descricao or '—' }}</td>
      <td>{{ contato.cargo_descricao or '—' }}</td>
      <td>{{ 'Ativo' if contato.status else 'Inativo' }}</td>
      <td>
        <a href="{{ url_for('contato_editar', contato_id=contato.id_contato_cliente) }}">Editar</a>
        {% if cliente.nome_fantasia.upper() != 'CENTRALCOMM' %}
        <form method="POST" action="{{ url_for('contato_toggle_status', contato_id=contato.id_contato_cliente) }}" style="display:inline">
          <button type="submit">{{ 'Desativar' if contato.status else 'Ativar' }}</button>
        </form>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>Nenhum contato vinculado a este cliente.</p>
<p><a href="{{ url_for('contato_novo') }}?cliente_id={{ cliente.id_cliente }}">Adicionar Primeiro Contato</a></p>
{% endif %}

{% endblock %}