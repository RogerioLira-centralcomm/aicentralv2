{% extends 'base_tailwind.html' %}

{% block title %}Detalhes do Cliente - CentralComm AI{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-4">
  <!-- Header -->
  <div class="flex items-center justify-between mb-3">
    <div>
      <h1 class="text-lg font-semibold leading-tight">Detalhes do Cliente</h1>
      <p class="text-sm text-base-content/70">{{ cliente.nome_fantasia or cliente.razao_social }}</p>
    </div>
    <div class="flex gap-2">
      <a href="{{ url_for('cliente_editar', cliente_id=cliente.id_cliente) }}" class="btn btn-primary btn-sm">
        <i class="fas fa-edit mr-1"></i>Editar
      </a>
      <a href="{{ url_for('clientes') }}" class="btn btn-ghost btn-sm">
        <i class="fas fa-arrow-left mr-1"></i>Voltar
      </a>
    </div>
  </div>

  <!-- Informações Principais -->
  <div class="bg-base-100 rounded-xl shadow-lg p-4 mb-4">
    <h2 class="text-md font-semibold mb-3 flex items-center">
      <i class="fas fa-info-circle mr-2 text-primary"></i>Informações Principais
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">ID do Cliente:</span>
        <span class="text-base-content">#{{ cliente.id_cliente }}</span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Status:</span>
        <span class="badge badge-sm {% if cliente.status %}badge-success{% else %}badge-error{% endif %}">
          {{ 'Ativo' if cliente.status else 'Inativo' }}
        </span>
      </div>
      {% if cliente.pessoa != 'F' %}
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Razão Social:</span>
        <span class="text-base-content">{{ cliente.razao_social }}</span>
      </div>
      {% endif %}
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">{{ 'Nome Completo' if cliente.pessoa == 'F' else 'Nome Fantasia' }}:</span>
        <span class="text-base-content">{{ cliente.nome_fantasia }}</span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">{{ 'CPF' if cliente.pessoa == 'F' else 'CNPJ' }}:</span>
        <span class="text-base-content">{{ cliente.cnpj or 'Não informado' }}</span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Total de Contatos:</span>
        <span class="text-base-content">{{ cliente.total_contatos }}</span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Executivo de Vendas:</span>
        <span class="text-base-content">{% if cliente.vendedor_nome %}{{ cliente.vendedor_nome }}{% if cliente.vendedor_cargo %} ({{ cliente.vendedor_cargo }}){% endif %}{% else %}—{% endif %}</span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Apresentação:</span>
        <span class="text-base-content">{{ cliente.apresentacao_executivo_display or 'Não informado' }}</span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Fluxo de Boas-Vindas:</span>
        <span class="text-base-content">{{ cliente.fluxo_boas_vindas_display or 'Não informado' }}</span>
      </div>
      {% if cliente.pessoa != 'F' %}
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Agência:</span>
        <span class="text-base-content">
          {% set ag_key = cliente.agencia_key|string|lower %}
          {{ 'Sim' if (cliente.agencia_key == True or ag_key in ['sim','true','1','s','yes','y']) else 'Não' }}
        </span>
      </div>
      {% endif %}
      {% set ag_key = cliente.agencia_key|string|lower %}
      {% if cliente.pessoa != 'F' and (cliente.agencia_key == True or ag_key in ['sim','true','1','s','yes','y']) %}
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Percentual:</span>
        <span class="text-base-content">{{ cliente.percentual_display or '—' }}</span>
      </div>
      {% endif %}
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Estado:</span>
        <span class="text-base-content">
          {% if cliente.estado_sigla or cliente.estado_descricao %}
            {{ cliente.estado_sigla }}{% if cliente.estado_sigla and cliente.estado_descricao %} - {% endif %}{{ cliente.estado_descricao }}
          {% else %}
            Não informado
          {% endif %}
        </span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Tipo de Cliente:</span>
        <span class="text-base-content">{{ cliente.tipo_cliente_display or 'Não informado' }}</span>
      </div>
      {% if cliente.pessoa != 'F' %}
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Inscrição Estadual:</span>
        <span class="text-base-content">{{ cliente.inscricao_estadual or 'Não informado' }}</span>
      </div>
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Inscrição Municipal:</span>
        <span class="text-base-content">{{ cliente.inscricao_municipal or 'Não informado' }}</span>
      </div>
      {% endif %}
      <div class="flex">
        <span class="font-semibold text-base-content/70 w-40">Plano:</span>
        <span class="text-base-content">
          {% if cliente.plano_descricao %}
            {{ cliente.plano_descricao }} ({{ cliente.plano_tokens }} tokens)
          {% else %}
            Nenhum plano associado
          {% endif %}
        </span>
      </div>
    </div>

    {% if cliente.nome_fantasia.upper() != 'CENTRALCOMM' %}
    <div class="mt-4 pt-4 border-t border-base-200">
      <form method="POST" action="{{ url_for('cliente_toggle_status', cliente_id=cliente.id_cliente) }}">
        <button type="submit" class="btn btn-sm {% if cliente.status %}btn-error{% else %}btn-success{% endif %}">
          <i class="fas {% if cliente.status %}fa-ban{% else %}fa-check{% endif %} mr-1"></i>
          {{ 'Desativar' if cliente.status else 'Ativar' }} Cliente
        </button>
      </form>
    </div>
    {% endif %}
  </div>

  <!-- Contatos Vinculados -->
  <div class="bg-base-100 rounded-xl shadow-lg p-4">
    <h2 class="text-md font-semibold mb-3 flex items-center">
      <i class="fas fa-address-book mr-2 text-primary"></i>Contatos Vinculados
    </h2>
    {% if contatos %}
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-base-200 text-xs">
        <thead class="bg-gradient-to-r from-primary to-accent text-white text-xs">
          <tr class="h-7">
            <th class="px-2 py-1 text-left font-bold uppercase tracking-wider">Nome</th>
            <th class="px-2 py-1 text-left font-bold uppercase tracking-wider">Email</th>
            <th class="px-2 py-1 text-left font-bold uppercase tracking-wider">Telefone</th>
            <th class="px-2 py-1 text-left font-bold uppercase tracking-wider">Setor</th>
            <th class="px-2 py-1 text-left font-bold uppercase tracking-wider">Cargo</th>
            <th class="px-2 py-1 text-left font-bold uppercase tracking-wider">Status</th>
            <th class="px-2 py-1 text-left font-bold uppercase tracking-wider">Ações</th>
          </tr>
        </thead>
        <tbody class="bg-base-100 divide-y divide-base-200 text-xs">
        {% for contato in contatos %}
          <tr class="hover:bg-base-200 transition h-7 align-middle">
            <td class="px-2 py-1 whitespace-nowrap text-base-content font-semibold">{{ contato.nome_completo }}</td>
            <td class="px-2 py-1 whitespace-nowrap text-base-content">{{ contato.email }}</td>
            <td class="px-2 py-1 whitespace-nowrap text-base-content">{{ contato.telefone or 'Não informado' }}</td>
            <td class="px-2 py-1 whitespace-nowrap text-base-content">{{ contato.setor_descricao or '—' }}</td>
            <td class="px-2 py-1 whitespace-nowrap text-base-content">{{ contato.cargo_descricao or '—' }}</td>
            <td class="px-2 py-1 whitespace-nowrap">
              <span class="badge badge-sm {% if contato.status %}badge-success{% else %}badge-error{% endif %}">
                {{ 'Ativo' if contato.status else 'Inativo' }}
              </span>
            </td>
            <td class="px-2 py-1 whitespace-nowrap">
              <div class="flex items-center gap-1">
                <a href="{{ url_for('contato_editar', contato_id=contato.id_contato_cliente) }}" class="btn btn-xs btn-circle btn-outline btn-primary" title="Editar">
                  <i class="fas fa-edit"></i>
                </a>
                {% if cliente.nome_fantasia.upper() != 'CENTRALCOMM' %}
                <form method="POST" action="{{ url_for('contato_toggle_status', contato_id=contato.id_contato_cliente) }}" style="display:inline">
                  <button type="submit" class="btn btn-xs btn-circle btn-outline {% if contato.status %}btn-error{% else %}btn-success{% endif %}" title="{{ 'Desativar' if contato.status else 'Ativar' }}">
                    <i class="fas {% if contato.status %}fa-ban{% else %}fa-check{% endif %}"></i>
                  </button>
                </form>
                {% endif %}
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-8">
      <p class="mb-2 text-base-content/60 text-sm">Nenhum contato vinculado a este cliente.</p>
      <a href="{{ url_for('contato_novo') }}?cliente_id={{ cliente.id_cliente }}" class="btn btn-primary btn-sm">
        <i class="fas fa-plus mr-1"></i>Adicionar Primeiro Contato
      </a>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}