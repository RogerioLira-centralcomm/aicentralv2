{% extends 'base_tailwind.html' %}

{% block title %}{% if cliente %}Editar{% else %}Novo{% endif %} Cliente - CentralComm AI{% endblock %}

{% block content %}
<h1>{% if cliente %}Editar Cliente{% else %}Novo Cliente{% endif %}</h1>
<p><a href="{{ url_for('clientes') }}">Voltar</a></p>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul>
  {% for category, message in messages %}
  <li>{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}
{% endwith %}

<form method="POST" id="clienteForm">
  {% if cliente and cliente.id_cliente %}
  <input type="hidden" id="cliente_id" value="{{ cliente.id_cliente }}">
  {% endif %}

  {% set pessoa_current = request.form.get('pessoa') or (cliente.pessoa if cliente else 'J') %}

  <fieldset>
    <legend>Informações</legend>

    <label>Tipo de Pessoa *</label><br>
    <label><input type="radio" name="pessoa" value="J" {% if pessoa_current == 'J' %}checked{% endif %}> Pessoa Jurídica</label>
    <label><input type="radio" name="pessoa" value="F" {% if pessoa_current == 'F' %}checked{% endif %}> Pessoa Física</label>

    <br><br>
    <label>Agência *</label><br>
    {% for agencia in agencias %}
      <label><input type="radio" name="pk_id_tbl_agencia" value="{{ agencia.id_agencia }}" data-agencia-key="{{ (agencia.key|string)|lower }}" {% if cliente and cliente.pk_id_tbl_agencia == agencia.id_agencia %}checked{% endif %}{% if not cliente and loop.first %} checked{% endif %}> {{ agencia.display }}</label>
    {% endfor %}

    <br><br>
    <label>Vendas CentralComm *</label><br>
    <select name="vendas_central_comm" id="vendas_central_comm" required>
      <option value="">Selecione um executivo</option>
      {% if vendedores_cc %}
        {% for vend in vendedores_cc %}
        <option value="{{ vend.id_contato_cliente }}" {% if cliente and (cliente.vendas_central_comm == vend.id_contato_cliente) %}selected{% endif %}>{{ vend.nome_completo }}</option>
        {% endfor %}
      {% endif %}
    </select>

    <br><br>
    <label>Apresentação do Executivo</label><br>
    {% if apresentacoes %}
      {% for ap in apresentacoes %}
      <label><input type="radio" name="id_apresentacao_executivo" value="{{ ap.id_tbl_apresentacao_executivo }}" {% if (cliente and cliente.id_apresentacao_executivo == ap.id_tbl_apresentacao_executivo) or (not cliente and (ap.display|lower == 'sim' or loop.first)) %}checked{% endif %}> {{ ap.display }}</label>
      {% endfor %}
    {% endif %}

    <br><br>
    <label>Fluxo de Boas-Vindas *</label><br>
    {% if fluxos %}
      {% for fx in fluxos %}
      <label><input type="radio" name="id_fluxo_boas_vindas" value="{{ fx.id_fluxo_boas_vindas }}" {% if (cliente and cliente.id_fluxo_boas_vindas == fx.id_fluxo_boas_vindas) or (not cliente and loop.first) %}checked{% endif %}> {{ fx.display }}</label>
      {% endfor %}
    {% endif %}

    <br><br>
    <label>Razão Social *</label><br>
    <input type="text" name="razao_social" value="{{ cliente.razao_social if cliente else '' }}" required>

    <br><br>
    <label>Nome Fantasia *</label><br>
    <input type="text" name="nome_fantasia" value="{{ cliente.nome_fantasia if cliente else '' }}" required>

    <br><br>
    <label>CNPJ/CPF *</label><br>
    <input type="text" name="cnpj" value="{{ cliente.cnpj if cliente else '' }}" required>

    <br><br>
    <label>Inscrição Estadual</label><br>
    <input type="text" name="inscricao_estadual" value="{{ cliente.inscricao_estadual if cliente else '' }}">

    <br><br>
    <label>Inscrição Municipal</label><br>
    <input type="text" name="inscricao_municipal" value="{{ cliente.inscricao_municipal if cliente else '' }}">

    <br><br>
    <label>Tipo de Cliente *</label><br>
    <select name="id_tipo_cliente" required>
      <option value="">Selecione um tipo</option>
      {% for tipo in tipos_cliente %}
      <option value="{{ tipo.id_tipo_cliente }}" {% if cliente and cliente.id_tipo_cliente == tipo.id_tipo_cliente %}selected{% endif %}>{{ tipo.display }}</option>
      {% endfor %}
    </select>

    <br><br>
    <label>Plano *</label><br>
    <select name="pk_id_tbl_plano" required>
      <option value="">Selecione um plano</option>
      {% for plano in planos %}
        {% if plano.status %}
        <option value="{{ plano.id_plano }}" {% if cliente and cliente.pk_id_tbl_plano == plano.id_plano %}selected{% endif %}>{{ plano.descricao }} - {{ "{:,}".format(plano.tokens).replace(',', '.') }} tokens</option>
        {% endif %}
      {% endfor %}
    </select>

    <br><br>
    <label>Percentual</label><br>
    <select name="id_percentual">
      <option value="">Selecione um percentual</option>
      {% if percentuais %}
        {% for perc in percentuais %}
        <option value="{{ perc.id_percentual }}" {% if cliente and cliente.id_percentual == perc.id_percentual %}selected{% endif %}>{{ perc.display }}</option>
        {% endfor %}
      {% endif %}
    </select>

    <br><br>
    <label>CEP</label><br>
    <input type="text" name="cep" id="cep" value="{{ cliente.cep if cliente else '' }}">

    <br><br>
    <label>Estado</label><br>
    <select name="pk_id_aux_estado" id="estado">
      <option value="">Selecione</option>
      {% for estado in estados %}
      <option value="{{ estado.id_estado }}" {% if cliente and cliente.pk_id_aux_estado == estado.id_estado %}selected{% endif %}>{{ estado.sigla }} - {{ estado.descricao }}</option>
      {% endfor %}
    </select>

    <br><br>
    <label>Cidade</label><br>
    <input type="text" name="cidade" id="cidade" value="{{ cliente.cidade if cliente else '' }}">

    <br><br>
    <label>Bairro</label><br>
    <input type="text" name="bairro" id="bairro" value="{{ cliente.bairro if cliente else '' }}">

    <br><br>
    <label>Logradouro</label><br>
    <input type="text" name="logradouro" id="logradouro" value="{{ cliente.logradouro if cliente else '' }}">

    <br><br>
    <label>Número</label><br>
    <input type="text" name="numero" id="numero" value="{{ cliente.numero if cliente else '' }}">

    <br><br>
    <label>Complemento</label><br>
    <input type="text" name="complemento" id="complemento" value="{{ cliente.complemento if cliente else '' }}">
  </fieldset>

  <input type="hidden" name="pk_id_tbl_agencia_pf" value="2">

  <br>
  <p>
    <a href="{{ url_for('clientes') }}">Cancelar</a>
    <button type="submit">{% if cliente %}Atualizar{% else %}Cadastrar{% endif %}</button>
  </p>
</form>
{% endblock %}