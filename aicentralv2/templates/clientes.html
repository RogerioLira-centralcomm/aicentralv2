{% extends 'base_tailwind.html' %}

{% block title %}Clientes - CentralComm AI{% endblock %}

{% block content %}
<h1>Clientes</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul>
    {% for category, message in messages %}
    <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}
{% endwith %}

<p><a href="{{ url_for('cliente_novo') }}">Novo Cliente</a></p>

{% if clientes %}
<table>
  <thead>
    <tr>
      <th>Cliente</th>
      <th>Executivo</th>
      <th>Tipo</th>
      <th>Status</th>
      <th>Contatos</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
  {% for cliente in clientes %}
    <tr>
      <td>
        {{ cliente.nome_fantasia or cliente.razao_social }}
        {% if cliente.nome_fantasia %}<br>{{ cliente.razao_social }}{% endif %}
      </td>
      <td>
        {% if cliente.executivo %}{{ cliente.executivo.nome_completo }}{% else %}Não atribuído{% endif %}
      </td>
      <td>{{ cliente.tipo_pessoa }}</td>
      <td>{{ 'Ativo' if cliente.status else 'Inativo' }}</td>
      <td>{{ cliente.total_contatos }}</td>
      <td>
        <a href="{{ url_for('cliente_editar', cliente_id=cliente.id_cliente) }}">Editar</a> |
        <a href="{{ url_for('cliente_detalhes', cliente_id=cliente.id_cliente) }}">Detalhes</a>
        {% if cliente.nome_fantasia.upper() != 'CENTRALCOMM' %}
        <form method="POST" action="{{ url_for('cliente_toggle_status', cliente_id=cliente.id_cliente) }}" style="display:inline">
          <button type="submit">{% if not cliente.status %}Ativar{% else %}Desativar{% endif %}</button>
        </form>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
 </table>
{% else %}
<p>Nenhum cliente cadastrado.</p>
<p><a href="{{ url_for('cliente_novo') }}">Cadastrar Primeiro Cliente</a></p>
{% endif %}

{% endblock %}
