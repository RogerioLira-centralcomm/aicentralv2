{% extends 'base_tailwind.html' %}

{% block title %}Contatos - CentralComm AI{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <div class="flex items-center justify-between mb-3">
    <div>
      <h1 class="text-lg font-semibold leading-tight">Contatos</h1>
      <p class="text-sm text-base-content/70">Gerencie os contatos cadastrados na plataforma.</p>
    </div>
    <a href="{{ url_for('contato_novo') }}" class="btn btn-primary btn-sm"><i class="fas fa-plus mr-2 text-xs"></i>Novo Contato</a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-6 space-y-2">
        {% for category, message in messages %}
          <div class="alert {% if category == 'error' %}alert-error{% elif category == 'success' %}alert-success{% elif category == 'warning' %}alert-warning{% else %}alert-info{% endif %}">
            <span>{{ message }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="bg-base-100 rounded-xl shadow-lg overflow-hidden">
    {% if contatos %}
      <div class="overflow-x-auto">
        <table class="table table-xs w-full">
          <thead class="bg-gradient-to-r from-primary to-accent text-white">
            <tr>
              <th class="text-left font-bold uppercase">Nome</th>
              <th class="text-left font-bold uppercase">Email</th>
              <th class="text-left font-bold uppercase">Cliente</th>
              <th class="text-left font-bold uppercase">Cargo</th>
              <th class="text-center font-bold uppercase w-24">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for contato in contatos %}
            <tr class="hover">
              <td>
                <div class="font-semibold text-base-content">{{ contato.nome_completo }}</div>
              </td>
              <td>
                <a href="mailto:{{ contato.email }}" class="text-primary hover:underline text-sm">{{ contato.email }}</a>
              </td>
              <td>
                <span class="text-base-content text-sm">{{ contato.nome_fantasia }}</span>
              </td>
              <td>
                <span class="text-base-content/70 text-sm">{{ contato.cargo_descricao or 'Não definido' }}</span>
              </td>
              <td>
                <div class="flex items-center justify-center gap-1">
                  <a href="{{ url_for('contato_editar', contato_id=contato.id_contato_cliente) }}" class="btn btn-xs btn-circle btn-outline btn-primary" title="Editar">
                    <i class="fas fa-edit"></i>
                  </a>
                  {% if contato.id_contato_cliente != session.user_id %}
                  <form method="POST" action="{{ url_for('contato_toggle_status', contato_id=contato.id_contato_cliente) }}" class="inline-block">
                    <button type="submit" class="btn btn-xs btn-circle btn-outline {% if not contato.status %}btn-success{% else %}btn-error{% endif %}" title="{% if not contato.status %}Ativar{% else %}Desativar{% endif %}">
                      <i class="fas {% if not contato.status %}fa-check{% else %}fa-ban{% endif %}"></i>
                    </button>
                  </form>
                  {% endif %}
                  <form method="POST" action="{{ url_for('contato_deletar', contato_id=contato.id_contato_cliente) }}" class="inline-block" onsubmit="return confirm('Tem certeza que deseja deletar este contato?');">
                    <button type="submit" class="btn btn-xs btn-circle btn-outline btn-error" title="Deletar">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-8">
        <p class="mb-2 text-base-content/60 text-sm">Nenhum contato cadastrado.</p>
        <a href="{{ url_for('contato_novo') }}" class="btn btn-primary btn-sm"><i class="fas fa-plus mr-2 text-xs"></i>Cadastrar Primeiro Contato</a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}