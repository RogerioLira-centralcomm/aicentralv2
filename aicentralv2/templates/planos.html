{% extends 'base_tailwind.html' %}

{% block title %}Planos - CentralComm AI{% endblock %}

{% block content %}
<div class="p-6">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <h1 class="text-3xl font-bold text-text-primary flex items-center">
                <i class="fas fa-layer-group text-primary mr-3"></i>
                Planos
            </h1>
            <div class="flex gap-3">
                <a href="{{ url_for('plano_form') }}" class="inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-light transition-colors duration-200 shadow-md">
                    <i class="fas fa-plus mr-2"></i>
                    Novo Plano
                </a>
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-6 space-y-2">
                {% for category, message in messages %}
                    <div class="flex items-center p-4 rounded-lg shadow-md {% if category == 'error' %}bg-red-50 text-red-800 border border-red-200{% elif category == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif category == 'warning' %}bg-yellow-50 text-yellow-800 border border-yellow-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
                        <i class="fas fa-{% if category == 'error' %}exclamation-circle{% elif category == 'success' %}check-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %} mr-3"></i>
                        <span class="flex-1">{{ message }}</span>
                        <button onclick="closeFlashMessage(this)" class="ml-4 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Table -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <table class="min-w-full">
            <thead>
                <tr class="bg-gray-50 text-gray-600 text-sm leading-normal">
                    <th class="py-3 px-6 text-left font-semibold">Descrição</th>
                    <th class="py-3 px-6 text-center font-semibold">Tokens</th>
                    <th class="py-3 px-6 text-center font-semibold">Status</th>
                    <th class="py-3 px-6 text-center font-semibold">Ações</th>
                </tr>
            </thead>
            <tbody class="text-gray-600 text-sm">
                {% for plano in planos %}
                <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="py-3 px-6 text-left">
                        <span class="font-medium">{{ plano.descricao }}</span>
                    </td>
                    <td class="py-3 px-6 text-center">{{ "{:,}".format(plano.tokens).replace(',', '.') }}</td>
                    <td class="py-3 px-6 text-center">
                        <button onclick="toggleStatus('{{ plano.id_plano }}')" class="relative">
                            <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-primary-light dark:peer-focus:ring-primary dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 {% if plano.status %}peer-checked{% endif %} {% if plano.status %}bg-primary{% endif %}">
                            </div>
                        </button>
                    </td>
                    <td class="py-3 px-6 text-center">
                        <div class="flex item-center justify-center gap-2">
                            <a href="{{ url_for('plano_form', id_plano=plano.id_plano) }}" class="text-blue-600 hover:text-blue-900" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function toggleStatus(id_plano) {
    try {
        const response = await fetch(`/planos/${id_plano}/toggle_status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            location.reload();
        } else {
            console.error('Erro ao alterar status');
            alert('Erro ao alterar status do plano');
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao alterar status do plano');
    }
}

function closeFlashMessage(button) {
    button.parentElement.remove();
}
</script>
{% endblock %}